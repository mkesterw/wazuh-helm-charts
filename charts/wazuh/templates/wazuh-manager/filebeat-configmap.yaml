{{- if or .Values.wazuhManager.master.enabled .Values.wazuhManager.worker.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "wazuh.fullname" . }}-filebeat-config
  namespace: {{ .Values.global.namespace }}
  labels:
    {{- include "wazuh.labels" . | nindent 4 }}
    app: wazuh-manager
data:
  filebeat.yml: |
    # Desabilitar Filebeat 7.10.2 bundled completamente
    # O Filebeat 8.x sidecar fará todo o trabalho de coleta e envio
    
    # Manter um input desabilitado para evitar erro "no modules or inputs enabled"
    filebeat.inputs:
      - type: log
        enabled: false
        paths:
          - /dev/null

    setup.template.enabled: false
    setup.ilm.enabled: false
    
    # Recarga de configuração desabilitada para evitar reinicializações
    filebeat.config:
      modules:
        enabled: false
    
    logging.level: error

    # Output necessário para Filebeat iniciar (mesmo desabilitado)
    output.elasticsearch:
      hosts: ["http://wazuh-indexer:9200"]
      username: "admin"
      password: "admin"
{{- end }}
